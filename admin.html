<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link rel="icon" type="image/png" href="/static/images/LOGOPNG.png"/>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

<section class="booking-section">
    <h2 class="booking-title">Admin Dashboard</h2>

    <div class="booking-card" style="max-width:1100px;">

        <h3 style="text-align:center; margin-bottom:30px; color:#FFD700;">
            All Bookings
        </h3>

        <div style="overflow-x:auto;">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>SL No</th>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Service</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="bookingsTable"></tbody>
            </table>
        </div>

        <div style="display:flex; justify-content:space-between; margin-top:30px;">
            <a href="/" style="color:#FFD700; text-decoration:none;">
                ← Back to Home
            </a>

            <a href="/admin/logout" style="color:#ff4d4d; text-decoration:none;">
                Logout
            </a>
        </div>

    </div>
</section>



<section class="booking-section review-moderation-section">
    <div class="booking-card admin-review-card">

        <h3 class="admin-section-title">
            Review Moderation
        </h3>

        <div class="table-wrapper">
            <table class="admin-table review-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Rating</th>
                        <th>Message</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody id="reviewsTable"></tbody>
            </table>
        </div>

    </div>
</section>



<script>
const API = "https://sushma-salian-backend.onrender.com";

async function loadAdminData() {
  const res = await fetch(`${API}/api/admin/data`, {
    credentials: "include"
  });

  if (!res.ok) {
    alert("Unauthorized. Please login.");
    window.location.href = "/admin-login.html";
    return;
  }

  const data = await res.json();
  renderBookings(data.bookings);
  renderReviews(data.reviews);
}

function renderBookings(bookings) {
  const tbody = document.getElementById("bookingsTable");
  tbody.innerHTML = "";

  bookings.forEach((b, i) => {
    tbody.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${b.name}</td>
        <td>${b.phone}</td>
        <td>${b.service}</td>
        <td>${b.date}</td>
        <td>${b.time}</td>
        <td>
          <button onclick="deleteBooking(${b.id})">Delete</button>
        </td>
      </tr>
    `;
  });
}

function renderReviews(reviews) {
  const tbody = document.getElementById("reviewsTable");
  tbody.innerHTML = "";

  reviews.forEach(r => {
    tbody.innerHTML += `
      <tr>
        <td>${r.name || "Anonymous"}</td>
        <td>${r.rating} ★</td>
        <td>${r.message}</td>
        <td>${r.approved ? "Approved" : "Pending"}</td>
        <td>
          ${!r.approved ? `<button onclick="approveReview(${r.id})">Approve</button>` : ""}
          <button onclick="deleteReview(${r.id})">Delete</button>
        </td>
      </tr>
    `;
  });
}

async function deleteBooking(id) {
  await fetch(`${API}/api/admin/booking/${id}`, {
    method: "DELETE",
    credentials: "include"
  });
  loadAdminData();
}

async function approveReview(id) {
  await fetch(`${API}/api/admin/review/approve/${id}`, {
    method: "POST",
    credentials: "include"
  });
  loadAdminData();
}

async function deleteReview(id) {
  await fetch(`${API}/api/admin/review/${id}`, {
    method: "DELETE",
    credentials: "include"
  });
  loadAdminData();
}

loadAdminData();
</script>



</body>
</html>
